# 病历表文件上传功能说明

## 功能概述

本应用已实现自动病历表文件上传功能。当用户登录并开始新的会话时，系统会自动将该用户对应的病历表文件上传到 Dify AI 系统，使 AI 能够基于用户的病历信息提供更准确的健康咨询。

## 用户配置

系统预配置了两个用户及其对应的病历表文件：

1. **用户：张三**
   - 用户名：`zhangsan`
   - 密码：`zhang123`
   - 病历表文件：`/patient-records/1.pdf`

2. **用户：李四**
   - 用户名：`lisi`
   - 密码：`li123456`
   - 病历表文件：`/patient-records/2.pdf`

## 实现细节

### 1. 系统用户配置（`src/data/systemUsers.ts`）
- 为每个系统用户添加了 `medicalRecordFile` 属性
- 指定了用户对应的 PDF 病历表文件路径

### 2. Dify API 服务增强（`src/services/difyApi.ts`）
- 新增文件上传方法 `uploadFile()`
- 支持自动上传病历表文件到 Dify 平台
- 在新会话第一次发送消息时，自动上传用户的病历表文件
- 使用文件ID缓存机制，避免重复上传
- 文件上传后，将文件ID附加到聊天消息请求中

### 3. 聊天界面集成（`src/components/ChatInterface.tsx`）
- 在发送消息时，自动获取当前用户的病历表文件路径
- 将文件路径传递给 Dify API 服务

## 工作流程

1. 用户登录系统
2. 用户开始新的聊天会话
3. 用户发送第一条消息时：
   - 系统检测到是新会话
   - 根据用户名查找对应的病历表文件
   - 自动上传病历表文件到 Dify
   - 获取文件ID并缓存
   - 将文件ID附加到聊天请求中
4. AI 基于用户的病历信息提供个性化健康建议

## 注意事项

1. **文件格式**：目前支持 PDF 格式的病历表文件
2. **文件大小**：每个文件上传限制为 15MB
3. **安全性**：文件通过 HTTPS 安全传输
4. **隐私保护**：文件ID仅在会话期间有效，会话结束后自动清理

## 扩展建议

1. 支持更多文件格式（如 Word、图片等）
2. 允许用户手动上传或更新病历表
3. 实现病历表版本管理
4. 添加文件上传进度提示
5. 支持多文件上传（如检查报告、化验单等）

## 开发调试

如需查看文件上传日志，请打开浏览器开发者工具的 Console 标签，可以看到：
- 文件上传成功信息：`文件上传成功: [文件名], ID: [文件ID]`
- 文件上传失败信息：`文件上传失败: [错误信息]` 